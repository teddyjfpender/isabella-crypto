version: 1.0.0
title: Isabella Review Phase
description: Verify Isabelle theory compiles and proofs are valid

instructions: |
  You are reviewing an Isabelle/HOL theory for correctness.

  VERIFICATION STEPS:
  1. Run `isabelle build -d <project_dir> <session_name>`
  2. Check exit code: 0 = success, non-zero = failure

  REVIEW CRITERIA:
  1. Does `isabelle build` succeed?
  2. Are there any `sorry` or `oops` (cheating)?
  3. Does `export_code` generate valid Haskell?

  IF BUILD FAILS:
  - Extract the specific error messages
  - Write clear feedback identifying:
    - Which line has the error
    - What the error type is (type error, undefined, etc.)
    - Suggestion for how to fix it

  DECISION:
  - SHIP: Build succeeds, no cheating, code exports
  - REVISE: Any failure - provide specific feedback

  OUTPUT FILES:
  - review-result.txt: "SHIP" or "REVISE"
  - review-feedback.txt: Specific errors and suggestions (if REVISE)

prompt: |
  ## Isabella Review Phase

  Verify the generated Isabelle theory:

  1. Run: `isabelle build -v -d <work_dir> <session_name>`
  2. If exit 0: Check for `sorry` usage with grep
  3. If no sorry and build passes: SHIP
  4. Otherwise: REVISE with specific feedback

  Provide actionable feedback that helps fix the issues.

extensions:
  - type: builtin
    name: developer
    timeout: 300
